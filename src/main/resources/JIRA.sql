CREATE TABLE UTILISATEUR (
    ID          NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    USERNAME    VARCHAR2(50)  NOT NULL UNIQUE,
    EMAIL       VARCHAR2(100) NOT NULL UNIQUE,
    PWD         VARCHAR2(100) NOT NULL,
    ACTIF       NUMBER(1) DEFAULT 1 NOT NULL
);

CREATE TABLE PROFIL (
    ID              NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    FULLNAME        VARCHAR2(100) NOT NULL,
    METIER          VARCHAR2(100) NOT NULL,
    UTILISATEUR_ID  NUMBER       NOT NULL UNIQUE,
    CONSTRAINT FK_PROFIL_UTILISATEUR
        FOREIGN KEY (UTILISATEUR_ID)
        REFERENCES UTILISATEUR(ID)
);

CREATE TABLE PROJET (
    ID                  NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    PROJET_NAME        VARCHAR2(100) NOT NULL UNIQUE,
    PROJET_DESCRIPTION VARCHAR2(200) NOT NULL,
    CREATION_DATE       DATE DEFAULT SYSDATE NOT NULL,
    PROJET_STATUS VARCHAR2(20) DEFAULT 'TODO' NOT NULL,
    OWNER_ID            NUMBER NOT NULL,
    CONSTRAINT FK_PROJET_OWNER
        FOREIGN KEY (OWNER_ID)
        REFERENCES UTILISATEUR(ID)
);

CREATE TABLE TICKET(
    ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    TITLE VARCHAR2(100) NOT NULL UNIQUE,
    TICKET_DESCRIPTION  VARCHAR(200) NOT NULL,
    TICKET_STATUS VARCHAR2(20) DEFAULT 'TODO' NOT NULL,
    TICKET_PRIORITY VARCHAR2(20) DEFAULT 'LOW' NOT NULL
    CREATION_DATE   DATE DEFAULT SYSDATE NOT NULL,
    DEADLINE    DATE,
    PROJET_ID           NUMBER NOT NULL,
    CREATOR_ID          NUMBER NOT NULL,
    ASSIGNE_ID          NUMBER,
    CONSTRAINT FK_TICKET_PROJET
        FOREIGN KEY (PROJET_ID)
        REFERENCES PROJET(ID),

    CONSTRAINT FK_TICKET_CREATOR
        FOREIGN KEY (CREATOR_ID)
        REFERENCES UTILISATEUR(ID),

    CONSTRAINT FK_TICKET_ASSIGNE
        FOREIGN KEY (ASSIGNE_ID)
        REFERENCES UTILISATEUR(ID)
);

CREATE TABLE COMMENTAIRE (
    ID              NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CONTENU         VARCHAR2(500) NOT NULL,
    CREATION_DATE   DATE DEFAULT SYSDATE NOT NULL,
    AUTEUR_ID       NUMBER NOT NULL,
    TICKET_ID       NUMBER NOT NULL,
    CONSTRAINT FK_COMMENTAIRE_AUTEUR
        FOREIGN KEY (AUTEUR_ID)
        REFERENCES UTILISATEUR(ID),
    CONSTRAINT FK_COMMENTAIRE_TICKET
        FOREIGN KEY (TICKET_ID)
        REFERENCES TICKET(ID)
);


CREATE TABLE TAG (
    ID      NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    NAME    VARCHAR2(50) NOT NULL UNIQUE,
);

CREATE TABLE TICKET_TAG (
    TICKET_ID   NUMBER NOT NULL,
    TAG_ID      NUMBER NOT NULL,
    CONSTRAINT PK_TICKET_TAG
        PRIMARY KEY (TICKET_ID, TAG_ID),
    CONSTRAINT FK_TICKET_TAG_TICKET
        FOREIGN KEY (TICKET_ID)
        REFERENCES TICKET(ID),
    CONSTRAINT FK_TICKET_TAG_TAG
        FOREIGN KEY (TAG_ID)
        REFERENCES TAG(ID)
);
